<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AdminPhotoDAO">


    <select id="photoList" parameterType="com.esoom.templeate.admin.service.BoardVO" resultType="com.esoom.templeate.admin.service.BoardVO">
        SELECT *
		FROM (
		select a.*,ROW_NUMBER() OVER (ORDER BY num) AS rownum,FORMAT(wdate, 'yyyy-MM-dd') AS formatted_date 
		from kcc2022_esoom.egis.TBL_NEWS a
		where 1=1
		and a.part = 'photo'
		<if test="searchKeyword != null">
			<if test='searchKeyword != ""'>
				and (a.subject like CONCAT('%', #{searchKeyword}, '%') or a.keyword_tag like CONCAT('%', #{searchKeyword}, '%'))
			</if>
		</if>
		<if test="sdate != null and edate !=null">
			<if test='sdate != "" and edate !=""'>
				and CONVERT(char(10),a.wdate,23) BETWEEN #{sdate} AND #{edate}
			</if>
		</if>
		) A
		ORDER BY num desc
		
    </select>
	<select id="getTotalPhotoListCount" resultType="int">
		select count(*)
		from (
		select * from kcc2022_esoom.egis.TBL_NEWS
		where 1=1
		and part = #{part}
		) A
	</select>
	<select id="getPhotoListCount" resultType="int">
		select count(*) from (select a.* from kcc2022_esoom.egis.TBL_NEWS a
		where 1=1
		and a.part = 'photo'
		<if test="searchKeyword != null">
			<if test='searchKeyword != ""'>
				and (a.subject like CONCAT('%', #{searchKeyword}, '%') or a.keyword_tag like CONCAT('%', #{searchKeyword}, '%'))
			</if>
		</if>
		<if test="sdate != null and edate !=null">
			<if test='sdate != "" and edate !=""'>
				and CONVERT(char(10),a.wdate,23) BETWEEN #{sdate} AND #{edate}
			</if>
		</if>
		) A
	</select>
	<select id="boardPhotoList" resultType="com.esoom.templeate.admin.service.BoardPhotoVO">
		select * from
		kcc2022_esoom.egis.TBL_NEWS_PHOTO
		where 1=1
		and info_num =#{num}
		order by
		num
	</select>
	<update id="boardPhotoMerge" parameterType="com.esoom.templeate.admin.service.BoardPhotoVO">
		merge into
		kcc2022_esoom.egis.TBL_NEWS_PHOTO A
		using
		(
		select #{num} AS num
		,#{photofile} AS photofile
		,#{info_num} AS info_num
		) B
		on A.num = B.num
		WHEN MATCHED THEN
		UPDATE set
		A.photofile = B.photofile
		WHEN not MATCHED THEN
		INSERT (
		photofile
		,info_num
		,wdate
		)
		values (
		B.photofile
		,B.info_num
		,getdate()
		);

	</update>
	<delete id="deleteBoardPhoto" parameterType="com.esoom.templeate.admin.service.BoardPhotoVO">
		delete from
		kcc2022_esoom.egis.TBL_NEWS_PHOTO
		where num = #{num}
	</delete>
</mapper>